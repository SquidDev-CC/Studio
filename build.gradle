apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'

sourceCompatibility = 1.8
version = '0.1'

repositories {
	mavenCentral()
}

dependencies {
	compile group: 'org.apache.bcel', name: 'bcel', version: '5.+'
	compile group: 'org.ow2.asm', name: 'asm-all', version: '5.+'
	testCompile group: 'junit', name: 'junit', version: '4.+'
}

uploadArchives {
	repositories {
		flatDir {
			dirs 'build'
		}
	}
}

sourceSets {
	main {
		java {
			srcDir 'src/main/java'
			srcDir 'luaj/src/core'
			srcDir 'luaj/src/jse'
		}

		resources {
			exclude '**/__ignore/*'
		}
	}

	test {
		java {
			srcDir 'src/test'
		}
	}
}

test {
	filter {
		includeTestsMatching "squidev.*"
	}

	beforeTest { descriptor ->
		logger.lifecycle("Running test: " + descriptor)
	}

	// listen to standard out and standard error of the test JVM(s)
	onOutput { descriptor, event ->
		logger.lifecycle("Test: " + descriptor + " produced standard out/err: " + event.message)
	}
}

task luaJTest(type: Test) {
	include 'luaj/test/junit'

	workingDir = "luaj"

	testLogging.showStandardStreams = true

	/*resources {
		srcDir 'luaj/test/lua'
	}*/
}
